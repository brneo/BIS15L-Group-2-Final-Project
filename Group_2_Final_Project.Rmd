---
title: "group2covidfoodproject"
author: “Mildred Hernandez, Brian Rezende, Margarita Ibarra, Byron Corado”
date: "`r Sys.Date()`"
output: 
  html_document: 
    keep_md: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(janitor)
library(here)
library(scales)
options(scipen=999) #disables scientific notation when printing
```

###Loading the Data
```{r}
food_supply <- readr::read_csv("data/Food_Supply_Quantity_kg_Data.csv")
```
###Cleaning the Data
```{r}
food_supply_clean <- janitor::clean_names(food_supply)
food_supply_clean
```
###Viewing the Data
```{r}
glimpse(food_supply_clean)
```
```{r}
summary(food_supply_clean)
```

```{r}
food_supply_clean %>%
  naniar::miss_var_summary()
```
###Analysis
```{r}
food_supply_clean %>%
  select(country, deaths, population) %>%
  arrange(desc(deaths)) %>% 
  head(n=3)
```
```{r}
food_supply_clean %>%
  select(country, deaths, population) %>%
  arrange((deaths)) %>% 
  head(n=3)
```

***Total Protein Consumption by Country, Focusing on those with the Three HIGHEST Death Percentages**
```{r}
food_supply_clean %>%
  filter(country=="Belgium"| country=="Slovenia"| country=="United Kingdom") %>%
  group_by(country, deaths, population) %>%
  summarize(total_protein_consumption = sum(animal_fats, animal_products, aquatic_products_other, eggs, fish_seafood, meat, milk_excluding_butter, offals))%>%
  arrange(desc(total_protein_consumption))
```

***Total Protein Consumption by Country, Focusing on those with the Three LOWEST Death Percentages**
```{r}
food_supply_clean %>%
  filter(country=="Cambodia"| country=="Dominica"| country=="Lao People's Democratic Republic") %>%
  group_by(country, deaths, population) %>%
  summarize(total_protein_consumption = sum(animal_fats, animal_products, aquatic_products_other, eggs, fish_seafood, meat, milk_excluding_butter, offals)) %>%
  arrange(-desc(total_protein_consumption))
```
***Total Protein Consumption by Country, Focusing on those with the United States' Death Percentages***
```{r}
food_supply_clean %>%
  filter(country=="United States of America") %>%
  group_by(country, deaths, population) %>%
  summarize(total_protein_consumption = sum(animal_fats, animal_products, aquatic_products_other, eggs, fish_seafood, meat, milk_excluding_butter, offals))
```
```{r}
protein_graph<-food_supply_clean %>%
  filter(country=="Belgium"| country=="Slovenia"| country=="United Kingdom"|country=="Cambodia"| country=="Dominica"| country=="Lao People's Democratic Republic"|country=="United States of America") %>%
  group_by(country) %>%
  summarize(total_protein_consumption = sum(animal_fats, animal_products, aquatic_products_other, eggs, fish_seafood, meat, milk_excluding_butter, offals)) %>%
  ggplot(aes(x=reorder(country, total_protein_consumption), y=total_protein_consumption, fill=country))+
  geom_col()+
  coord_flip()+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank())+
  labs(title = "Percentage of Protein Intake by Country (%)",
       x=NULL,
       y="Protein Consumption",
       fill = "country")+
  theme(plot.title=element_text(hjust=0.5), axis.text.x = element_text(angle = 45, hjust=1))
protein_graph
```
higher protein because it's a bigger country...

***Total Grain Consumption by Country, Focusing on those with the Three HIGHEST Death Percentages***
```{r}
grains_highest <-food_supply_clean %>%
  group_by(country, deaths, population) %>%
  filter( country == "United Kingdom"| country == "Slovenia" | country == "Belgium"  ) %>% 
  summarize(total_grain_consumption = sum(alcoholic_beverages, cereals_excluding_beer, oilcrops, pulses, spices))
grains_highest
```
***Total Grain Consumption by Country, Focusing on those with the Three LOWEST Death Percentages***
```{r}
grains_lowest <-food_supply_clean %>%
  group_by(country, deaths, population) %>%
  filter( country == "Cambodia"| country == "Dominica" | country == "Lao People's Democratic Republic") %>% 
  summarize(total_grain_consumption = sum(alcoholic_beverages, cereals_excluding_beer, oilcrops, pulses, spices))
grains_lowest
```
***Total Protein Consumption by Country, Focusing on those with the United States' Death Percentages***
```{r}
grains_us <-food_supply_clean %>%
  group_by(country, deaths, population) %>%
  filter( country == "United States of America") %>% 
  summarize(total_grain_consumption = sum(alcoholic_beverages, cereals_excluding_beer, oilcrops, pulses, spices))
grains_us
```
```{r}
grains_graph <-food_supply_clean %>%
  group_by(country) %>%
  filter( country == "Cambodia"| country == "Dominica" | country == "Lao People's Democratic Republic" | country == "United Kingdom"| country == "Slovenia" | country == "Belgium" | country == "United States of America") %>% 
  summarize(total_grain_consumption = sum(alcoholic_beverages, cereals_excluding_beer, oilcrops, pulses, spices)) %>% 
  ggplot(aes(x=reorder(country, total_grain_consumption), y=total_grain_consumption, fill=country))+
  geom_col()+
  coord_flip()+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank())+
  labs(title = "Percentage of Grain Intake by Country (%)",
       x=NULL,
       y="Grain Consumption",
       fill = "country")+
  theme(plot.title=element_text(hjust=0.5), axis.text.x = element_text(angle = 45, hjust=1))
grains_graph
```

***Total Fruit Consumption by Country, Focusing on those with the Three HIGHEST Death Percentages***
```{r}
fruits_highest<-food_supply_clean %>%
  filter(country=="Belgium"| country=="Slovenia"| country=="United Kingdom") %>%
  group_by(country, deaths, population) %>%
  summarize(total_fruit_consumption = sum(fruits_excluding_wine, stimulants),.groups = 'keep') %>%
  arrange(desc(deaths))
fruits_highest
```

***Total Fruit Consumption by Country, Focusing on those with the Three LOWEST Death Percentages***
```{r}
fruits_lowest<-food_supply_clean %>%
  filter(country=="Cambodia"| country=="Dominica"| country=="Lao People's Democratic Republic") %>%
  group_by(country, deaths, population) %>%
  summarize(total_fruit_consumption = sum(fruits_excluding_wine, stimulants),.groups = 'keep') %>%
  arrange(desc(deaths))
fruits_lowest
```

***Total Fruit Consumption by Country, Focusing on those with the United States' Death Percentages***
```{r}
fruits_us<-food_supply_clean %>%
  filter(country=="United States of America") %>%
  group_by(country, deaths, population) %>%
  summarize(total_fruit_consumption = sum(fruits_excluding_wine, stimulants),
            .groups = 'keep')
fruits_us
```

##Fruit Consumption Table
```{r}
fruits_graph<-food_supply_clean %>%
  filter(country=="Cambodia"| country=="Dominica"| country=="Lao People's Democratic Republic"| country=="United States of America" | country=="Belgium"| country=="Slovenia"| country=="United Kingdom") %>%
  group_by(country) %>%
  summarize(total_fruit_consumption = sum(fruits_excluding_wine, stimulants),.groups = 'keep') %>%
  ggplot(aes(x=reorder(country, total_fruit_consumption), y=total_fruit_consumption, fill=country))+
  geom_col()+
  coord_flip()+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank())+
  labs(title = "Percentage of Fruit Intake by Country (%)",
       x=NULL,
       y="Fruit Consumption",
       fill = "country")
fruits_graph
```
#works outside of the "theme" xlab(“”)
***Total Veggies Consumption by Country, Focusing on those with the Three HIGHEST Death Percentages***
```{r}
veggies_highest <-food_supply_clean %>%
  group_by(country, deaths, population) %>%
  filter(country == "Belgium" | country == "Slovenia" | country == "United Kingdom") %>% 
  summarise(total_veggie_consumption = sum(starchy_roots, sugar_crops, sugar_sweeteners, treenuts, vegetable_oils, vegetables, vegetal_products))
veggies_highest
```
***Total Veggies Consumption by Country, Focusing on those with the Three HIGHEST Death Percentages***
```{r}
veggies_lowest <-food_supply_clean %>%
  group_by(country, deaths, population) %>%
  filter(country == "Cambodia" | country == "Dominica" | country == "Lao People's Democratic Republic") %>% 
  summarise(total_veggie_consumption = sum(starchy_roots, sugar_crops, sugar_sweeteners, treenuts, vegetable_oils, vegetables, vegetal_products))
veggies_lowest
```
***Total Veggies Consumption by Country, Focusing on those with the United States' Death Percentages***
```{r}
veggies_us <-food_supply_clean %>%
  group_by(country, deaths, population) %>%
  filter(country == "United States of America") %>% 
  summarise(total_veggie_consumption = sum(starchy_roots, sugar_crops, sugar_sweeteners, treenuts, vegetable_oils, vegetables, vegetal_products))
veggies_us
```

```{r}
veggies_graph <-food_supply_clean %>%
  group_by(country) %>%
  filter( country == "Cambodia"| country == "Dominica" | country == "Lao People's Democratic Republic" | country == "United Kingdom"| country == "Slovenia" | country == "Belgium" | country == "United States of America") %>%
  summarise(total_veggie_consumption = sum(starchy_roots, sugar_crops, sugar_sweeteners, treenuts, vegetable_oils, vegetables, vegetal_products)) %>% 
  ggplot(aes(x=reorder(country, total_veggie_consumption), y=total_veggie_consumption, fill=country))+
  geom_col()+
  coord_flip()+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank())+
  labs(title = "Percentage of Vegetable Intake by Country (%)",
       x=NULL,
       y="Vegetable Consumption",
       fill = "country")+
  theme(plot.title=element_text(hjust=0.5), axis.text.x = element_text(angle = 45, hjust=1))
veggies_graph
```
#mutate each country to fill by letter given to the countries (3 lowest countries will be A and 3 highest countries will be B) or gradient based on value of y axis

***Total Category Consumption of Each Country***
```{r}
total_food_consumption<-food_supply_clean %>%
  filter(country=="Belgium"| country=="Slovenia"| country=="United Kingdom"|country=="Cambodia"| country=="Dominica"| country=="Lao People's Democratic Republic"|country=="United States of America") %>%
  select(country:obesity, deaths) %>%
  group_by(country, deaths) %>%
  summarize(total_protein_consumption = sum(animal_fats, animal_products, aquatic_products_other, eggs, fish_seafood, meat, milk_excluding_butter, offals),
            total_veggie_consumption = sum(starchy_roots, sugar_crops, sugar_sweeteners, treenuts, vegetable_oils, vegetables, vegetal_products),
            total_fruit_consumption = sum(fruits_excluding_wine, stimulants),
            total_grain_consumption = sum(alcoholic_beverages, cereals_excluding_beer, oilcrops, pulses, spices), .groups = 'keep') %>% 
  arrange(desc(deaths))
total_food_consumption
```

***Scattered Plots***
```{r}
obesity_scatter<-food_supply_clean %>%
  filter(country=="Belgium"| country=="Slovenia"| country=="United Kingdom"|country=="Cambodia"| country=="Dominica"| country=="Lao People's Democratic Republic"|country=="United States of America") %>%
  select(country, obesity, deaths, population) %>%
  group_by(country, obesity) %>%
  ggplot(aes(x=country, y=obesity, color=country, shape=country)) +
  geom_point(size=3) + #geom_smooth(method="lm", se=FALSE)+
  theme(plot.title=element_text(hjust=0.5), axis.text.x = element_text(angle = 45, hjust=1))
obesity_scatter
```
```{r}
undernourished_scatter<-food_supply_clean %>%
  filter(country=="Belgium"| country=="Slovenia"| country=="United Kingdom"|country=="Cambodia"| country=="Dominica"| country=="Lao People's Democratic Republic"|country=="United States of America") %>%
  #select(country, undernourished, deaths, population) %>%
  group_by(country, undernourished) %>%
  ggplot(aes(x=country, y=undernourished, color=country, shape=country)) +
  geom_point(size=3) + geom_smooth(method="lm", se=FALSE)+
  theme(plot.title=element_text(hjust=0.5), axis.text.x = element_text(angle = 45, hjust=1))
undernourished_scatter
```
***Test app***
```{r}
TFC_long <- total_food_consumption %>%
  pivot_longer(-country,
               names_to = "category",
               values_to = "values")
TFC_long <- TFC_long %>% 
  filter(category != "deaths")
TFC_long
```


ui <- dashboardPage( skin="yellow",
  dashboardHeader(title = "Food Categories of Country"),
  dashboardSidebar(disable = T),
  dashboardBody(
  fluidRow(
  box(title = "Country Details", width = 3,
  selectInput("x", "Select Country", choices = c("Afghanistan", "Albania", "Algeria", "Angola", "Antigua and Barbuda", "Argentina", "Armenia", "Australia", "Austria", "Azerbaijan", "Bahamas", "Bangladesh", "Barbados","Belarus", "Belgium", "Belize", "Benin", "Bolivia", "Bosnia and Herzegovina", "Botswana", "Brazil", "Bulgaria", "Burkina Faso", "Cabo Verde", "Cambodia", "Cameroon", "Canada", "Central African Republic", "Chad", "Chile", "China", "Colombia", "Congo", "Costa Rica", "Cote d'Ivoire", "Croatia", "Cuba", "Cyprus", "Czechia", "Denmark", "Djibouti", "Dominica", "Dominican Republic", "Ecuador", "Egypt", "El Salvador", "Estonia", "Eswatini", "Ethiopia", "Fiji", "Finland", "France", "French Polynesia", "Gabon", "Gambia", "Georgia", "Germany", "Ghana", "Greece", "Grenada", "Guatemala", "Guinea", "Guinea-Bissau", "Guyana", "Haiti", "Honduras", "Hungary", "Iceland", "India", "Indonesia", "Iran (Islamic Republic of)", "Iraq", "Ireland", "Israel", "Italy", "Jamaica", "Japan", "Jordan", "Kazakhstan", "Kenya", "Kiribati", "Korea, North", "Korea, South", "Kuwait", "Kyrgyzstan", "Lao People's Democratic Republic", "Latvia", "Lebanon", "Lesotho", "Liberia", "Lithuania", "Luxembourg", "Madagascar", "Malawi", "Malaysia", "Maldives", "Mali", "Malta", "Mauritania", "Mauritius", "Mexico", "Mongolia", "Montenegro", "Morocco", "Mozambique", "Myanmar", "Namibia", "Nepal", "Netherlands", "New Caledonia", "New Zealand", "Nicaragua", "Niger", "Nigeria", "North Macedonia", "Norway", "Oman", "Pakistan", "Panama", "Paraguay", "Peru", "Philippines", "Poland", "Portugal", "Republic of Moldova", "Romania", "Russian Federation", "Rwanda", "Saint Kitts and Nevis", "Saint Lucia", "Saint Vincent and the Grenadines", "Samoa", "Sao Tome and Principe", "Saudi Arabia", "Senegal", "Serbia", "Sierra Leone", "Slovakia", "Slovenia", "Solomon Islands", "South Africa", "Spain", "Sri Lanka", "Sudan", "Suriname", "Sweden", "Switzerland", "Taiwan*", "Tajikistan", "Thailand", "Timor-Leste", "Togo", "Trinidad and Tobago", "Tunisia", "Turkey", "Turkmenistan", "Uganda", "Ukraine", "United Arab Emirates", "United Kingdom", "United Republic of Tanzania", "United States of America", "Uruguay", "Uzbekistan", "Vanuatu", "Venezuela (Bolivarian Republic of)", "Vietnam", "Yemen", "Zambia", "Zimbabwe"), 
              selected = "Afghanistan")),
  box(title = "Country Details", width = 7,
  plotOutput("plot", width = "600px", height = "500px")
  ) 
  ) 
  ) 
)

server <- function(input, output, session) { 
  
  output$plot <- renderPlot({
  country_tfc_long %>%
  filter(country==input$x) %>%
  ggplot(aes(x=category, y=values)) +
  geom_col(fill="blue3", alpha = 0.75, size=4)+
  labs(x="Country", y="Deaths")+
  theme_light(base_size = 18) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
  })
  session$onSessionEnded(stopApp)
  }

shinyApp(ui, server)

```{r}
TFC_long %>% 
  ggplot(aes(x = "", y = values, fill = category))+
  geom_col(stat = "identity", width = 1, position = 'fill')+
  coord_polar(theta = "y")+
  theme(axis.title.y=element_blank(),
        axis.text.y=element_blank(),
        axis.ticks.y=element_blank())+
  facet_wrap(~country) + theme_void()
```

***PLAY AROUND CODE***
```{r}
food_supply_clean %>%
  filter(country=="United States of America") %>%
  group_by(country, deaths, population) %>%
  summarize(total_protein_consumption = sum(animal_fats, animal_products, aquatic_products_other, eggs, fish_seafood, meat, milk_excluding_butter, offals),
            total_veggie_consumption = sum(starchy_roots, sugar_crops, sugar_sweeteners, treenuts, vegetable_oils, vegetables, vegetal_products),
            total_fruit_consumption = sum(fruits_excluding_wine, stimulants),
            total_grain_consumption = sum(alcoholic_beverages, cereals_excluding_beer, oilcrops, pulses, spices),
            .groups = 'keep') %>%
  arrange(desc(deaths))
```

```{r}
country_tfc<-food_supply_clean %>%
  group_by(country, deaths, population) %>%
  summarize(total_protein_consumption = sum(animal_fats, animal_products, aquatic_products_other, eggs, fish_seafood, meat, milk_excluding_butter, offals),
            total_veggie_consumption = sum(starchy_roots, sugar_crops, sugar_sweeteners, treenuts, vegetable_oils, vegetables, vegetal_products),
            total_fruit_consumption = sum(fruits_excluding_wine, stimulants),
            total_grain_consumption = sum(alcoholic_beverages, cereals_excluding_beer, oilcrops, pulses, spices), .groups = 'keep') %>% 
  arrange(desc(deaths))
country_tfc
```
```{r}
country_tfc_long <- country_tfc %>%
  pivot_longer(-country,
               names_to = "category",
               values_to = "values")
country_tfc_long <- country_tfc_long %>% 
  filter(category != "deaths", category != "population")
country_tfc_long
```
**
```{r}
food_supply_clean <- food_supply_clean %>% 
   mutate(undernourished= as.numeric(str_replace(undernourished, '<', '')))
```

```{r}
undernourished_bar<-food_supply_clean %>%
  filter(country=="Belgium"| country=="Slovenia"| country=="United Kingdom"|country=="Cambodia"| country=="Dominica"| country=="Lao People's Democratic Republic"|country=="United States of America") %>%
  select(country, undernourished, deaths, population) %>%
  group_by(country, undernourished) %>%
  ggplot(aes(x=country, y=undernourished, fill=country)) +
  geom_col(alpha=0.5)+
  theme(plot.title=element_text(hjust=0.5), axis.text.x = element_text(angle = 45, hjust=1))+
  theme(legend.position = "none")+
  labs(title = "Percentage of Global Undernourished Rates",
       x = "Country",
       y = "Undernourished Rate (%)")
undernourished_bar
```
```{r}
obesity_bar<-food_supply_clean %>%
  filter(country=="Belgium"| country=="Slovenia"| country=="United Kingdom"|country=="Cambodia"| country=="Dominica"| country=="Lao People's Democratic Republic"|country=="United States of America") %>%
  select(country, obesity, deaths, population) %>%
  group_by(country, obesity) %>%
  ggplot(aes(x=country, y=obesity, fill=country, shape=country)) +
  geom_col(alpha=0.5)+
  theme(plot.title=element_text(hjust=0.5), axis.text.x = element_text(angle = 45, hjust=1))+
  theme(legend.position = "none")+
  labs(title = "Percentage of Global Obesity Rates",
       x = "Country",
       y = "Obesity Rate (%)")
obesity_bar
```

***Margarita's Stuff***
```{r}
TFC_long %>% 
  mutate(pct = round(values, digits = 2))
```
```{r}
cats <- TFC_long$category
cats <- str_replace(cats, c('total_protein_consumption'), replacement = 'Protein')
cats <- str_replace(cats, c('total_veggie_consumption'), replacement = 'Vegetables')
cats <- str_replace(cats, c('total_fruit_consumption'), replacement = 'Fruits')
cats <- str_replace(cats, c('total_grain_consumption'), replacement = 'Grains')
```

```{r}
TFC_long2 <-TFC_long %>% 
  mutate(labels = round(values, digits = 2))
TFC_long2$grp = cats
sample <- TFC_long2 %>% 
  select(country, labels, grp)
```

```{r}
sample2 <- sample %>% 
  arrange(desc(grp)) %>% 
  mutate(prop = labels/sum(sample$labels)*100) %>% 
  mutate(ypos = cumsum(prop)-0.5*prop)
```


```{r}
ggplot(sample2, aes(x="", y = prop, fill = grp))+
  geom_bar(stat="identity", width=1, color="white") +
  coord_polar("y", start=0) +
  theme_void() + 
  theme(legend.position= "right") +
  guides(fill = guide_legend(title = "Food Group"))+
  geom_text(aes(y = ypos, label = percent(labels/100)), color = "black", size=2, angle = 0,) +
  scale_fill_brewer(palette="Set2")+
  facet_wrap(~country)
```

***Mildred's stuff***

#download.file("http://thematicmapping.org/downloads/TM_WORLD_BORDERS_SIMPL-0.3.zip", #destfile="data/world_shape_file.zip")



#system("unzip DATA/world_shape_file.zip")



#world_spdf <- readOGR( 
#  dsn= paste0("C:/Users/mildr/OneDrive/Desktop/BIS15L-Group-2-Final-Project/data/TM_WORLD_BORDERS_SIMPL-0.3.shp"),
#  layer="TM_WORLD_BORDERS_SIMPL-0.3",
#  verbose=FALSE
#)

#shape_food_join <- full_join(world_spdf, food_supply_clean, by="" )
#fullJoinDf <- full_join(tableA,tableB,by=”Customer.ID”)
#View(fullJoinDf)



#library(leaflet)
#library(RColorBrewer)library(rgdal)library(ggplot2)
#library(maps)
#library(rworldmap)
#library(ggmap)

***Mildred's Stuff part 2***


#library(leaflet)
#library(RColorBrewer)
#library(rgdal)
#library(ggplot2)
#library(maps)
#library(rworldmap)
#library(ggmap)



#download.file("http://thematicmapping.org/downloads/TM_WORLD_BORDERS_SIMPL-0.3.zip", destfile="data/world_shape_file.zip")


#system("unzip DATA/world_shape_file.zip")



#world_spdf <- readOGR( 
  dsn= paste0("C:/Users/mildr/OneDrive/Desktop/BIS15L-Group-2-Final-Project/data/TM_WORLD_BORDERS_SIMPL-0.3.shp"), 
  layer="TM_WORLD_BORDERS_SIMPL-0.3",
  verbose=FALSE

#covid <- food_supply_clean %>%
  select(country, deaths, active, confirmed, recovered) %>%
  rename(NAME="country")
covid




#covid_shape_join <- full_join(world_spdf@data, covid, by="NAME")



#world_spdf@data$deaths[ which(world_spdf@data$deaths == 0)] = NA




#world_spdf@data$POP2005 <- as.numeric(as.character(world_spdf@data$POP2005)) / 1000000 %>% round(2)



#mypalette <- colorNumeric( palette="viridis", domain=world_spdf@data$deaths, na.color="transparent")
#mypalette(c(45,43))


#m <- leaflet(covid_shape_join) %>% 
  #addTiles() %>%
  #setView( lat=10, lng=0 , zoom=2) %>%
  #addPolygons( fillColor = ~mypalette(world_spdf@deaths), stroke=FALSE )


## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:


## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
